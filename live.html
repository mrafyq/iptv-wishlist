<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>IPTV Favoris</title>
        <link rel="stylesheet" href="live.css">
    </head>
    <body>
        <div class="sidebar" id="sidebar">
            <ul class="list-tabs">
                <li class="tab tab-bouquet selected" data-list="list-bouquet">Bouquet</li>
                <li class="tab tab-favoris" data-list="list-favoris">Favoris</li>
            </ul>
            <ul class="list-bouquet" id="sidebar-bouquet__list"></ul>
            <ul class="list-favoris" id="sidebar-favoris__list"></ul>
            <div id="wishlist-buttons" class="wishlist-buttons" style="display: none">
                <div class="action-rename"><div class="dot green"> </div>Renommer</div>
                <div class="action-delete"><div class="dot red"> </div>Déplacer</div>
                <div class="action-pin"><div class="dot yellow"> </div>Pin</div>
            </div>
        </div>
        
        <div class="screen">
            <div class="left">
                <div class="left-up">
                    <div class="group-name">Group Name</div>
                    <div>search <input id="search" type="text" placeholder="Search..." title="Search..."><i class="fa fa-search"></i></div>
                </div>
                <!-- attribute data-attr-back-list added for manage arrowLeft key-->
                <ul id="list-channels" class="list-channels"></ul>
            </div>
            <div class="right">
                <div class="date"> 19:54 | Fri Jun 23 2023</div>
                <div class="player"></div>
                <div class="epg">
                    <div>
                        7:50 PM - 8:00 PM C'est Canteloup
                    </div>
                    <div>
                        <progress value="46" max="100"></progress>
                    </div>
                    <ul>
                        <li>8:10 PM	Koh-Lanta, le totem maudi</li>
                        <li>10:30 PM	Et alors ?</li>
                        <li>12:00 PM	C'est Canteloup</li>
                        <li>13:10 PM	Koh-Lanta, le totem maudit</li>
                    </ul>
                </div>
                <div class="buttons" id="right-buttons">
                    <div>
                        <div class="dot green"></div> EPG guide
                    </div>
                    <div>
                        <div class="dot yellow"></div> Control parental
                    </div>
                    <!-- Add to Favoris -->
                    <div class="add-to-favoris">
                        <div class="dot blue"></div> Déplacer vers
                    </div>
                    <!-- Remove from Favoris -->
                    <div class="remove-from-favoris">
                        <div class="dot red"></div> Retirer de favoris
                    </div>
                    <div>
                        <div class="dot white"></div> Trier
                    </div>
                </div>
            </div>
        </div>
        <!-- Popup -->
        <div class="popup popup-rename">
            <div class="popup-inner">
                <div class="popup-title">Modifier le nom de favoris</div>
                <input type="text" id="rename" name="rename" placeholder="Nom de favoris souhaité ... ">
                <div>
                    <button type="button" class="action-rename-save">Enregistrer</button>
                    <button type="button" class="action-cancel">Annuler</button>
                </div>
            </div>
        </div>
        <div class="popup popup-favoris">
            <div class="popup-inner">
                <div class="popup-title">Ajouter au favoris</div>
                <div class="popup-favoris-name"></div>
                <ul class="popup-favoris-list-fav" id="popup-favoris-list-fav"></ul>
                <div>
                    <button type="button" class="action-favoris-save">Enregistrer</button>
                    <button type="button" class="action-favoris-cancel">Annuler</button>
                </div>
            </div>
        </div>
        <script  type="text/javascript">
            var favButton = document.querySelector('.add-to-favoris');
            var popupFav = document.querySelector('.popup.popup-favoris');
            var listFav = document.getElementById('sidebar-favoris__list');
            var listBouquet = document.getElementById('sidebar-bouquet__list');
            var listChannels0 = document.getElementById('list-channels');
            var popupFavList = document.getElementById('popup-favoris-list-fav');
            var buttonFavCancel = document.querySelector('.action-favoris-cancel');
            var buttonFavSave = document.querySelector('.action-favoris-save');
            
            fetch('data/db.json')
                .then(res => res.json())
                .then(data =>
                    {
                        (data.favoris).forEach((element, index) => {
                            const li = document.createElement('li');
                            li.setAttribute('id', element.favori_id);
                            li.setAttribute('data-name', element.favori_name);
                            li.setAttribute('class', 'favoris');
                            li.style.order = element.order;
                            li.innerHTML = element.favori_name;
                            listFav.appendChild(li);
                        });
                        (data.bouquets).forEach((element, index) => {
                            const li = document.createElement('li');
                            li.setAttribute('id', element.bouquet_id);
                            li.setAttribute('data-name', element.bouquet_name);
                            li.setAttribute('class', 'bouquet');
                            li.innerHTML = element.bouquet_name;
                            listBouquet.appendChild(li);
                        });
                        (data.channels).forEach((element, index) => {
                            const li = document.createElement('li');
                            li.setAttribute('data-attr-id', element.channel_id);
                            li.setAttribute('data-attr-name', element.channel_name);
                            if (index == 0) {
                                li.setAttribute('class', 'channel selected');
                            } else {
                                li.setAttribute('class', 'channel');
                            }
                            li.innerHTML = element.channel_name;
                            listChannels0.appendChild(li);
                        });
                    }
                )
                .catch(err => console.log(err));

            favButton.addEventListener('click', () => {
                popupFav.style.display = 'flex';

                fetch('data/db.json')
                    .then(res => res.json())
                    .then(data => {
                        popupFavList.innerHTML = '';
                        (data.favoris).forEach((element, index) => {
                            const li = document.createElement('li');
                            li.setAttribute('id', element.favori_id);
                            li.setAttribute('class', 'favoris');
                            /*li.innerHTML = element.favori_name;*/
                            li.innerHTML = `
                                <input type="checkbox" id="${element.favori_id}" name="${element.favori_name}" value="${element.favori_id}" /> ${element.favori_name}
                            `;
                            popupFavList.appendChild(li);
                        });
                        /*data.favoris.push({
                            "favori_id": parseInt(listChanSelectedID),
                            "favori_name": listChanSelectedName
                        });
                        console.log(data);*/
                    })
                    .catch(err => console.log(err));
            });
            
            buttonFavCancel.addEventListener('click', () => {
                popupFav.style.display = 'none';
            })


            buttonFavSave.addEventListener('click', () => {
                const listChanSelected = document.querySelector('#list-channels .channel.selected');
                const listChanSelectedID = listChanSelected.getAttribute('data-attr-id');
                const listChanSelectedName = listChanSelected.getAttribute('data-attr-name');
                const checkedFav = document.querySelectorAll('.popup-favoris-list-fav li input:checked');
                
                console.log(checkedFav);
                var favArr = [];
                checkedFav.forEach(el => {
                    favArr.push(parseInt(el.value));
                    console.log(el.value);
                })
                console.log(favArr);

                
                fetch('data/db.json')
                    .then(res => res.json())
                    .then(data => {
                        (data.favoris).forEach((element, index) => {
                            if (favArr.indexOf(element.favori_id) !== -1) {
                                console.log(element);
                                element.channels.push({
                                    "channel_id": parseInt(listChanSelectedID),
                                    "channel_name": listChanSelectedName
                                });
                            }
                        });
                        console.log(data.favoris);
                    })
                    .catch(err => console.log(err));
                

            })

        </script>
        <script type="text/javascript" src="live.js"></script>

    </body>
</html>