<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>IPTV Favoris</title>
        <link rel="stylesheet" href="./css/fonts.css">
        <link rel="stylesheet" href="./css/live.css">
    </head>
    <body>
        <div class="sidebar" id="sidebar">
            <ul class="list-tabs">
                <li class="tab tab-bouquet selected" data-list="list-bouquet">Bouquet</li>
                <li class="tab tab-favoris" data-list="list-favoris">Favoris</li>
            </ul>
            <ul class="list-bouquet" id="sidebar-bouquet__list"></ul>
            <ul class="list-favoris" id="sidebar-favoris__list"></ul>
            <div id="wishlist-buttons" class="wishlist-buttons" style="display: none">
                <div class="action-add"><div class="dot blue"> </div>Ajouter</div>
                <div class="action-delete"><div class="dot green"> </div>Déplacer</div>
                <div class="action-rename"><div class="dot red"> </div>Renommer/Supprimer</div>
                <div class="action-pin"><div class="dot yellow"> </div>Pin</div>
            </div>
            <div id="buckets-buttons" class="bucket-buttons" style="display: none">
                <div class="bucket-action-hide"><div class="dot blue"> </div>hide</div>
                <div class="bucket-action-pin"><div class="dot yellow"> </div>Pin</div>
            </div>
        </div>
        
        <div class="screen">
            <div class="left">
                <div class="left-up">
                    <div class="group-name">Group Name</div>
                    <div id="searchForm">search <input id="search" type="text" placeholder="Search..." title="Search..."><i class="fa fa-search"></i></div>
                </div>
                <!-- attribute data-attr-back-list added for manage arrowLeft key-->
                <ul id="list-channels" class="list-channels"></ul>
            </div>
            <div class="right">
                <div class="date"> 19:54 | Fri Jun 23 2023</div>
                <div class="player"></div>
                <div class="epg">
                    <div>
                        7:50 PM - 8:00 PM C'est Canteloup
                    </div>
                    <div>
                        <progress value="46" max="100"></progress>
                    </div>
                    <ul>
                        <li>8:10 PM	Koh-Lanta, le totem maudi</li>
                        <li>10:30 PM	Et alors ?</li>
                        <li>12:00 PM	C'est Canteloup</li>
                        <li>13:10 PM	Koh-Lanta, le totem maudit</li>
                    </ul>
                </div>
                <div class="buttons" id="right-buttons">
                    <div>
                        <div class="dot green"></div> EPG guide
                    </div>
                    <div>
                        <div class="dot yellow"></div> Control parental
                    </div>
                    <!-- Add to Favoris -->
                    <div class="add-to-favoris">
                        <div class="dot blue"></div> Déplacer vers
                    </div>
                    <!-- Remove from Favoris -->
                    <div class="remove-from-favoris">
                        <div class="dot red"></div> Retirer de favoris
                    </div>
                    <div>
                        <div class="dot white"></div> Trier <span class="sortBy"></span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Popup -->
        <div class="popup popup-rename">
            <div class="popup-inner">
                <div class="popup-content">
                    <div class="container-action-actions">
                        <div>
                            <input id="wishlist-rename" class="" type="radio" name="action" value="rename" checked>
                            <label for="wishlist-rename">Renommer</label>
                        </div>
                        <div>
                            <input id="wishlist-delete" type="radio" name="action" value="delete">
                            <label for="wishlist-delete">Supprimer</label>
                        </div>
                    </div>
                    <div class="container-action-rename">
                        <div class="popup-title">Renommer le favoris: <span class="popup-title-additional"></span></div>
                        <br>
                        <input type="text" id="rename" name="rename" placeholder="Nom de favoris souhaité ... ">
                        <br>
                        <br>
                        <div>
                            <button type="button" class="action-rename-save">Enregistrer</button>
                            <button type="button" class="action-cancel btn-cancel" data-popup="popup-rename">Annuler</button>
                        </div>
                    </div>
                    <div class="container-action-delete" style="display: none">
                        <div class="popup-title">Supprimer le favoris: <span class="popup-title-additional"></span></div>
                        <div>
                            <button type="button" class="action-delete-confirm">Confirmer la suppression</button>
                            <button type="button" class="action-cancel btn-cancel" data-popup="popup-rename">Annuler</button>
                        </div>
                    </div>
                </div>
                <div class="popup-success">
                    <div class="popup-success-inner">
                        <i class="icon-check-success"></i>
                        <div>Success !</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="popup popup-favoris">
            <div class="popup-inner">
                <div class="popup-content">
                    <div class="popup-title">Ajouter au favoris</div>
                    <div class="popup-favoris-name"></div>
                    <ul class="popup-favoris-list-fav" id="popup-favoris-list-fav"></ul>
                    <div>
                        <button type="button" class="action-favoris-save">Enregistrer</button>
                        <button type="button" class="action-favoris-cancel btn-cancel" data-popup="popup-favoris">Annuler</button>
                    </div>
                </div>
                <div class="popup-success">
                    <div class="popup-success-inner">
                        <i class="icon-check-success"></i>
                        <div>Success !</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="popup popup-add-wishlist">
            <div class="popup-inner">
                <div class="popup-content">
                    <div class="popup-title">Ajouter un nouveau favoris</div>
                    <form id="add-wishlist-form" name="add-wishlist-form" action="post">
                        <input type="text" id="add" name="favoris_name" minlength="3" required
                               title="Définir le nom de favoris" placeholder="Définir le nom de favoris">
                        <div>
                            <button type="submit" class="action-submit">Enregistrer</button>
                            <button type="button" class="btn-cancel" data-popup="popup-add-wishlist">Annuler</button>
                        </div>
                    </form>
                </div>
                <div class="popup-success">
                    <div class="popup-success-inner">
                        <i class="icon-check-success"></i>
                        <div>Success !</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="popup popup-remove-from-wishlist">
            <div class="popup-inner">
                <div class="popup-content">
                    <div class="popup-title"></div>
                    <form id="remove-from-wishlist-form" name="remove-from-wishlist-form" action="post">
                        <div>
                            <button type="submit" class="action-remove-from-wishlist-submit">Yes</button>
                            <button type="button" class="btn-cancel" data-popup="popup-remove-from-wishlist">Cancel</button>
                        </div>
                    </form>
                </div>
                <div class="popup-success">
                    <div class="popup-success-inner">
                        <i class="icon-check-success"></i>
                        <div>Success !</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="popup popup-check-pin">
            <div class="popup-inner">
                <div class="popup-content">
                    <div class="popup-title">Entrer votre PIN</div>
                    <input id="pin-field" type="password" class="field" placeholder="0000" title="Entrer votre PIN"/>
                    <div>
                        <button type="submit" class="action-pin-ok">OK</button>
                        <button type="button" class="btn-cancel" data-popup="popup-check-pin">Annuler</button>
                    </div>
                </div>
                <div class="popup-success">
                    <div class="popup-success-inner">
                        <i class="icon-check-success"></i>
                        <div>Success !</div>
                    </div>
                </div>
            </div>
        </div>
        <script  type="text/javascript">
            var favButton = document.querySelector('.add-to-favoris');
            var popupFav = document.querySelector('.popup.popup-favoris');
            var listFav = document.getElementById('sidebar-favoris__list');
            var listBouquet = document.getElementById('sidebar-bouquet__list');
            var listChannels0 = document.getElementById('list-channels');
            var popupFavList = document.getElementById('popup-favoris-list-fav');
            var buttonFavSave = document.querySelector('.action-favoris-save');
            
            fetch('data/db.json')
                .then(res => res.json())
                .then(data =>
                    {
                        (data.favoris).forEach((element, index) => {
                            const li = document.createElement('li');
                            li.setAttribute('id', element.favori_id);
                            li.setAttribute('data-name', element.favori_name);
                            li.setAttribute('data-pin', element.pin);
                            li.setAttribute('class', 'favoris');
                            li.style.order = element.order;
                            li.innerHTML = element.favori_name;
                            if (element.pin) {
                                const iconLock = document.createElement('i');
                                iconLock.setAttribute('class', 'icon-lock');
                                li.appendChild(iconLock);
                            }
                            listFav.appendChild(li);
                        });
                        (data.bouquets).forEach((element, index) => {
                            if (!element.hidden) {
                                const li = document.createElement('li');
                                li.setAttribute('id', element.bouquet_id);
                                li.setAttribute('data-name', element.bouquet_name);
                                li.setAttribute('data-pin', element.pin);
                                li.setAttribute('class', 'bouquet');
                                li.innerHTML = element.bouquet_name;
                                if (element.pin) {
                                    const iconLock = document.createElement('i');
                                    iconLock.setAttribute('class', 'icon-lock');
                                    li.appendChild(iconLock);
                                }
                                listBouquet.appendChild(li);
                            }
                        });
                        (data.channels).forEach((element, index) => {
                            const li = document.createElement('li');
                            li.setAttribute('data-attr-id', element.channel_id);
                            li.setAttribute('data-attr-name', element.channel_name);
                            if (index == 0) {
                                li.setAttribute('class', 'channel selected');
                            } else {
                                li.setAttribute('class', 'channel');
                            }
                            li.innerHTML = element.channel_name;
                            listChannels0.appendChild(li);
                        });
                    }
                )
                .catch(err => console.log(err));

            favButton.addEventListener('click', () => {
                popupAction = true;
                popupFav.classList.add('active');

                fetch('data/db.json')
                    .then(res => res.json())
                    .then(data => {
                        popupFavList.innerHTML = '';
                        (data.favoris).forEach((element, index) => {
                            const li = document.createElement('li');
                            li.setAttribute('id', element.favori_id);
                            li.setAttribute('class', 'favoris');
                            li.innerHTML = `
                                <input type="checkbox" id="${element.favori_id}" name="${element.favori_name}" value="${element.favori_id}" /> ${element.favori_name}
                            `;
                            popupFavList.appendChild(li);
                        });
                    })
                    .catch(err => console.log(err));
            });


            buttonFavSave.addEventListener('click', () => {
                const listChanSelected = document.querySelector('#list-channels .channel.selected');
                const listChanSelectedID = listChanSelected.getAttribute('data-attr-id');
                const listChanSelectedName = listChanSelected.getAttribute('data-attr-name');
                const checkedFav = document.querySelectorAll('.popup-favoris-list-fav li input:checked');
                
                console.log(checkedFav);
                var favArr = [];
                checkedFav.forEach(el => {
                    favArr.push(parseInt(el.value));
                    console.log(el.value);
                })
                console.log(favArr);

                
                fetch('data/db.json')
                    .then(res => res.json())
                    .then(data => {
                        (data.favoris).forEach((element, index) => {
                            if (favArr.indexOf(element.favori_id) !== -1) {
                                console.log(element);
                                element.channels.push({
                                    "channel_id": parseInt(listChanSelectedID),
                                    "channel_name": listChanSelectedName
                                });
                            }
                        });
                        console.log(data.favoris);
                    })
                    .catch(err => console.log(err));
                

            })

        </script>
        <script type="text/javascript" src="live.js"></script>
        <script type="text/javascript" src="js/wishlist/add.js"></script>
        <script type="text/javascript" src="js/wishlist/edit-remove.js"></script>
        <script type="text/javascript" src="js/wishlist/pin.js"></script>
        <script type="text/javascript" src="js/bucket/pin.js"></script>
        <script type="text/javascript" src="js/bucket/hide.js"></script>
    </body>
</html>